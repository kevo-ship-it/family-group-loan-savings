<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="text-center mb-4">Account Access</h2>

    <!-- Alert -->
    <div id="alert" class="alert" style="display:none;"></div>

    <!-- Login Form -->
    <form id="signin-form" class="card p-4" style="max-width: 500px; margin: auto;" autocomplete="on">
      <h4>Login</h4>
      <div class="mb-3">
        <label>Email</label>
        <input type="email" class="form-control" id="email" required />
      </div>
      <div class="mb-3">
        <label>Password</label>
        <input type="password" class="form-control" id="password" required />
      </div>
      <button type="submit" class="btn btn-primary w-100">Login</button>
      <div class="mt-3 text-center">
        <a href="#" id="forgot-password">Forgot Password?</a> |
        <a href="#" id="show-signup">Create Account</a>
      </div>
    </form>

    <!-- Sign Up Form -->
    <form id="register-form" class="card p-4" style="max-width: 500px; margin: auto; display: none;">
      <h4>Create Account</h4>
      <div class="mb-3">
        <label>Full Name</label>
        <input type="text" class="form-control" id="full-name" required />
      </div>
      <div class="mb-3">
        <label>Phone Number</label>
        <input type="text" class="form-control" id="phone-number" required />
      </div>
      <div class="mb-3">
        <label>ID Number</label>
        <input type="text" class="form-control" id="id-number" required />
      </div>
      <div class="mb-3">
        <label>Email</label>
        <input type="email" class="form-control" id="reg-email" required />
      </div>
      <div class="mb-3">
        <label>Password</label>
        <input type="password" class="form-control" id="reg-password" required />
      </div>
      <button type="submit" class="btn btn-success w-100">Sign Up</button>
      <div class="mt-3 text-center">
        <a href="#" id="show-signin">Already have an account?</a>
      </div>
    </form>

    <!-- Password Reset Form -->
    <form id="reset-form" class="card p-4" style="max-width: 500px; margin: auto; display: none;">
      <h4>Reset Password</h4>
      <div class="mb-3">
        <label>Email</label>
        <input type="email" class="form-control" id="reset-email" required />
      </div>
      <button type="submit" class="btn btn-warning w-100">Send Reset Link</button>
      <div class="mt-3 text-center">
        <a href="#" id="back-to-signin">Back to Login</a>
      </div>
    </form>
  </div>

  <script>
    // Initialize Supabase
    const supabase = supabase.createClient(
      'https://idwqayipyhsvdxmtalli.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlkd3FheWlweWhzdmR4bXRhbGxpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NDIyMDgsImV4cCI6MjA2MjUxODIwOH0.zA-xAQK71EV843i1uGhA2MM2ooxrIG2F_qM5xT-iuYI'
    );

    // Alert function
    function showAlert(message, type = 'info') {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = 'alert mt-3 alert-' + type;
      alert.style.display = 'block';
      setTimeout(() => { alert.style.display = 'none'; }, 5000);
    }

    // Toggle forms
    document.getElementById('show-signup').onclick = (e) => {
      e.preventDefault();
      document.getElementById('signin-form').style.display = 'none';
      document.getElementById('reset-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
    };
    document.getElementById('show-signin').onclick = (e) => {
      e.preventDefault();
      document.getElementById('register-form').style.display = 'none';
      document.getElementById('reset-form').style.display = 'none';
      document.getElementById('signin-form').style.display = 'block';
    };
    document.getElementById('forgot-password').onclick = (e) => {
      e.preventDefault();
      document.getElementById('signin-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'none';
      document.getElementById('reset-form').style.display = 'block';
    };
    document.getElementById('back-to-signin').onclick = (e) => {
      e.preventDefault();
      document.getElementById('reset-form').style.display = 'none';
      document.getElementById('signin-form').style.display = 'block';
    };

    // Login
    document.getElementById('signin-form').onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        showAlert(error.message, 'danger');
      } else {
        showAlert('Login successful!', 'success');
        setTimeout(() => window.location.href = 'dashboard.html', 1000);
      }
    };

    // Sign up
    document.getElementById('register-form').onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('reg-email').value;
      const password = document.getElementById('reg-password').value;
      const fullName = document.getElementById('full-name').value;
      const phoneNumber = document.getElementById('phone-number').value;
      const idNumber = document.getElementById('id-number').value;
      const { error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: {
            full_name: fullName,
            phone_number: phoneNumber,
            id_number: idNumber
          }
        }
      });
      if (error) {
        showAlert(error.message, 'danger');
      } else {
        showAlert('Account created. Please verify your email.', 'success');
        setTimeout(() => {
          document.getElementById('register-form').style.display = 'none';
          document.getElementById('signin-form').style.display = 'block';
        }, 2500);
      }
    };

    // Reset password
    document.getElementById('reset-form').onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('reset-email').value;
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: window.location.origin + '/reset-password.html'
      });
      if (error) {
        showAlert(error.message, 'danger');
      } else {
        showAlert('Password reset email sent.', 'success');
        setTimeout(() => {
          document.getElementById('reset-form').style.display = 'none';
          document.getElementById('signin-form').style.display = 'block';
        }, 3000);
      }
    };

    // Redirect if already logged in
    window.addEventListener('DOMContentLoaded', async () => {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        window.location.href = 'dashboard.html';
      }
    });
  </script>
</body>
</html>
